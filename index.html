<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Film da VixSrc</title>
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: white; padding: 20px; }
  .grid { display: flex; flex-wrap: wrap; gap: 15px; }
  .card { width: 150px; cursor: pointer; background: #222; padding: 10px; border-radius: 8px; text-align: center; }
  .card img { width: 100%; border-radius: 5px; }
  a { color: #1db954; text-decoration: none; }
  a:hover { text-decoration: underline; }
</style>
</head>
<body>
<h1>Film da VixSrc</h1>
<div id="loading">Sto caricando la lista da VixSrc...</div>
<div id="movies" class="grid"></div>

<script>
const tmdbApiKey = 'a3c17d492a24a9f77acb23626404edd1';

async function getMovieDetails(tmdbId) {
  const url = `https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${tmdbApiKey}&language=it-IT`;
  const res = await fetch(url);
  if (!res.ok) return null;
  return await res.json();
}

async function loadMovies() {
  const moviesContainer = document.getElementById('movies');
  const loading = document.getElementById('loading');
  loading.textContent = 'Caricamento in corso...';

  try {
    const res = await fetch('https://vixsrc.to/api/list/movie/?lang=it');
    if (!res.ok) throw new Error('Impossibile caricare la lista');
    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      loading.textContent = 'Nessun film trovato.';
      return;
    }

    // Prendiamo i primi 20 per non appesantire
    const tmdbIds = data.slice(0, 20).map(item => item.tmdb_id);

    for (const id of tmdbIds) {
      const details = await getMovieDetails(id);
      if (!details) continue;

      const card = document.createElement('div');
      card.className = 'card';

      card.innerHTML = `
        <a href="https://vixsrc.to/movie/${id}" target="_blank" rel="noopener noreferrer">
          <img src="https://image.tmdb.org/t/p/w300${details.poster_path}" alt="${details.title}" />
          <h3>${details.title}</h3>
          <p>${details.release_date ? details.release_date.substring(0,4) : 'N/D'}</p>
        </a>
      `;
      moviesContainer.appendChild(card);
    }
    loading.style.display = 'none';
  } catch (error) {
    loading.textContent = 'Errore nel caricamento dei dati.';
    console.error(error);
  }
}

loadMovies();
</script>
</body>
</html>
