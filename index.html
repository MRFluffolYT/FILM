<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Ricerca Film VixSrc + TMDb</title>
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: white; padding: 20px; }
  input[type="text"] { width: 300px; padding: 8px; font-size: 16px; border-radius: 4px; border: none; }
  button { padding: 8px 12px; font-size: 16px; border-radius: 4px; border: none; background: #1db954; color: white; cursor: pointer; }
  button:hover { background: #17a44c; }
  .results { margin-top: 20px; display: flex; flex-wrap: wrap; gap: 15px; }
  .card { width: 150px; cursor: pointer; background: #222; padding: 10px; border-radius: 8px; text-align: center; }
  .card img { width: 100%; border-radius: 5px; }
  iframe { margin-top: 30px; width: 100%; max-width: 800px; height: 450px; border: none; border-radius: 8px; }
</style>
</head>
<body>
<h1>Ricerca Film con TMDb + Player VixSrc</h1>

<div>
  <input type="text" id="searchInput" placeholder="Cerca un film..." />
  <button id="searchBtn">Cerca</button>
</div>

<div id="results" class="results"></div>

<iframe id="playerFrame" src="" style="display:none;" allowfullscreen></iframe>

<script>
const tmdbApiKey = 'a3c17d492a24a9f77acb23626404edd1';

async function searchMovies(query) {
  if (!query) return [];
  const url = `https://api.themoviedb.org/3/search/movie?api_key=${tmdbApiKey}&language=it-IT&query=${encodeURIComponent(query)}`;
  const res = await fetch(url);
  if (!res.ok) return [];
  const data = await res.json();
  return data.results || [];
}

function createMovieCard(movie) {
  const card = document.createElement('div');
  card.className = 'card';
  const poster = movie.poster_path ? `https://image.tmdb.org/t/p/w300${movie.poster_path}` : 'https://via.placeholder.com/150x225?text=No+Image';
  card.innerHTML = `
    <img src="${poster}" alt="${movie.title}" />
    <h3>${movie.title}</h3>
    <p>${movie.release_date ? movie.release_date.substring(0,4) : 'N/D'}</p>
  `;
  card.addEventListener('click', () => {
    const player = document.getElementById('playerFrame');
    player.src = `https://vixsrc.to/movie/${movie.id}`;
    player.style.display = 'block';
    // Scrolla al player
    player.scrollIntoView({behavior: 'smooth'});
  });
  return card;
}

document.getElementById('searchBtn').addEventListener('click', async () => {
  const query = document.getElementById('searchInput').value.trim();
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = 'Sto cercando...';
  const movies = await searchMovies(query);
  if (movies.length === 0) {
    resultsDiv.textContent = 'Nessun film trovato.';
    document.getElementById('playerFrame').style.display = 'none';
    return;
  }
  resultsDiv.innerHTML = '';
  movies.forEach(movie => {
    resultsDiv.appendChild(createMovieCard(movie));
  });
});

document.getElementById('searchInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    document.getElementById('searchBtn').click();
  }
});
</script>
</body>
</html>
